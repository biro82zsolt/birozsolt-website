<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <meta name="robots" content="noindex,follow">


  <title>Search – zsoltbiro.hu</title>
  <meta name="description" content="Search the content of zsoltbiro.hu." />

  <!-- Canonical + hreflang -->
  <link rel="canonical" href="https://zsoltbiro.hu/search" />
  <link rel="alternate" href="https://zsoltbiro.hu/kereses" hreflang="hu" />
  <link rel="alternate" href="https://zsoltbiro.hu/search" hreflang="en" />
  <link rel="alternate" href="https://zsoltbiro.hu/" hreflang="x-default" />

  <!-- Open Graph / Twitter (opcionális, de hasznos szép megosztáshoz) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="zsoltbiro.hu" />
  <meta property="og:title" content="Search – zsoltbiro.hu" />
  <meta property="og:description" content="Search the content of zsoltbiro.hu." />
  <meta property="og:url" content="https://zsoltbiro.hu/search" />
  <meta property="og:image" content="https://zsoltbiro.hu/static/images/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Search – zsoltbiro.hu" />
  <meta name="twitter:description" content="Search the content of zsoltbiro.hu." />
  <meta name="twitter:image" content="https://zsoltbiro.hu/static/images/og-image.jpg" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Structured Data: WebSite + SearchAction (EN target) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://zsoltbiro.hu",
    "name":"zsoltbiro.hu",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://zsoltbiro.hu/search?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <style>
    /* Skip link a11y-hoz */
    .visually-hidden-focusable {
      position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden;
    }
    .visually-hidden-focusable:focus,
    .visually-hidden-focusable:active {
      position: static; width: auto; height: auto;
      margin: .5rem; padding: .5rem .75rem; background: #ffd;
      border: 2px solid #333; border-radius: .25rem;
    }
  </style>
</head>
<body class="container py-4">

  <!-- Skip to content -->
  <a class="visually-hidden-focusable" href="#main">Skip to results</a>

  <header class="mb-3">
    <h1 class="h3 m-0">Search</h1>
  </header>

  <main id="main">
    <!-- Search form -->
    <form class="row g-2 mb-4" id="site-search-form" role="search" action="/search" method="get">
      <div class="col-auto">
        <label class="visually-hidden" for="q">Search query</label>
        <input class="form-control" type="search" name="q" id="q" placeholder="Search…" aria-label="Search" />
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>

    <!-- Live region: results summary -->
    <div id="results-info" class="small text-muted mb-2" aria-live="polite"></div>

    <!-- Results list -->
    <div id="results" class="list-group" aria-label="Search results"></div>
  </main>

  <!-- Fuse.js (lightweight fuzzy search) -->
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
  (async function () {
    // ---- settings (EN) ----
    const INDEX_PATH = '/static/search-index-en.json';
    const MSG = {
      type: 'Type at least 2 characters to search.',
      none: (q) => `No results for “${q}”.`,
      some: (n, q) => `${n} ${n === 1 ? 'result' : 'results'} for “${q}”.`
    };

    // ---- utils: accent folding + highlight ----
    const fold = (s='') => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
    const escapeRe = (s) => s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    const hi = (text, qRaw) => {
      if (!qRaw) return text;
      const re = new RegExp(`(${escapeRe(qRaw)})`, 'ig');
      return text.replace(re, '<mark>$1</mark>');
    };

    // ---- DOM ----
    const params = new URLSearchParams(location.search);
    const qRaw = (params.get('q') || '').trim();
    const qInput = document.getElementById('q');
    const info = document.getElementById('results-info');
    const list = document.getElementById('results');
    qInput.value = qRaw;

    // ---- load index ----
    let raw = [];
    try {
      const res = await fetch(INDEX_PATH, { cache: 'no-store' });
      raw = await res.json();
    } catch {
      info.textContent = 'Could not load search index.';
      return;
    }

    // ---- normalize for Fuse (accent-free), keep originals for display ----
    const data = raw.map(item => ({
      ...item,
      title_o: item.title || '',
      content_o: item.content || '',
      title: fold(item.title || ''),
      content: fold(item.content || ''),
      keywords: (item.keywords || []).map(fold),
      synonyms: (item.synonyms || []).map(fold),
      tags: (item.tags || []).map(fold),
      _date: new Date(item.date || '2000-01-01').getTime()
    }));

    // ---- Fuse (weighted fields + extended search) ----
    const fuse = new Fuse(data, {
      includeScore: true,
      useExtendedSearch: true,
      minMatchCharLength: 2,
      threshold: 0.34,
      keys: [
        { name: 'title',    weight: 0.7 },
        { name: 'keywords', weight: 0.6 },
        { name: 'synonyms', weight: 0.5 },
        { name: 'content',  weight: 0.4 },
        { name: 'tags',     weight: 0.3 }
      ]
    });

    // ---- search ----
    const query = fold(qRaw);
    let results = [];
    if (query.length >= 2) {
      results = fuse.search(query).slice(0, 50);
      // slight freshness boost
      results.sort((a, b) => {
        const boostA = a.item._date / 1e13;
        const boostB = b.item._date / 1e13;
        return (a.score - boostA) - (b.score - boostB);
      });
      results = results.slice(0, 20);
    }

    // ---- render ----
    list.innerHTML = '';
    if (!qRaw) {
      info.textContent = MSG.type;
      return;
    }
    info.textContent = results.length ? MSG.some(results.length, qRaw) : MSG.none(qRaw);

    results.forEach(r => {
      const it = r.item;
      const snippet = it.content_o || '';
      const short = snippet.length > 160 ? snippet.slice(0, 160) + '…' : snippet;

      const a = document.createElement('a');
      a.className = 'list-group-item list-group-item-action';
      a.href = it.url;
      a.innerHTML = `
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">${hi(it.title_o, qRaw)}</h5>
        </div>
        <p class="mb-1">${hi(short, qRaw)}</p>
        <small class="text-muted">${it.url}</small>
      `;
      list.appendChild(a);
    });

    // focus first result for keyboard users
    if (results.length) {
      const first = list.querySelector('a');
      if (first) first.focus();
    }

    // update URL on submit
    document.getElementById('site-search-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const newQ = qInput.value.trim();
      const url = new URL(location.href);
      if (newQ) url.searchParams.set('q', newQ); else url.searchParams.delete('q');
      location.href = url.toString();
    });
  })();
</script>

</body>
</html>
