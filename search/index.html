<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <title>Search – zsoltbiro.hu</title>
  <meta name="description" content="Search the content of zsoltbiro.hu." />

  <!-- Canonical + hreflang -->
  <link rel="canonical" href="https://zsoltbiro.hu/search" />
  <link rel="alternate" href="https://zsoltbiro.hu/kereses" hreflang="hu" />
  <link rel="alternate" href="https://zsoltbiro.hu/search" hreflang="en" />
  <link rel="alternate" href="https://zsoltbiro.hu/" hreflang="x-default" />

  <!-- Open Graph / Twitter (opcionális, de hasznos szép megosztáshoz) -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="zsoltbiro.hu" />
  <meta property="og:title" content="Search – zsoltbiro.hu" />
  <meta property="og:description" content="Search the content of zsoltbiro.hu." />
  <meta property="og:url" content="https://zsoltbiro.hu/search" />
  <meta property="og:image" content="https://zsoltbiro.hu/static/images/og-image.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Search – zsoltbiro.hu" />
  <meta name="twitter:description" content="Search the content of zsoltbiro.hu." />
  <meta name="twitter:image" content="https://zsoltbiro.hu/static/images/og-image.jpg" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Structured Data: WebSite + SearchAction (EN target) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "url":"https://zsoltbiro.hu",
    "name":"zsoltbiro.hu",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://zsoltbiro.hu/search?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <style>
    /* Skip link a11y-hoz */
    .visually-hidden-focusable {
      position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden;
    }
    .visually-hidden-focusable:focus,
    .visually-hidden-focusable:active {
      position: static; width: auto; height: auto;
      margin: .5rem; padding: .5rem .75rem; background: #ffd;
      border: 2px solid #333; border-radius: .25rem;
    }
  </style>
</head>
<body class="container py-4">

  <!-- Skip to content -->
  <a class="visually-hidden-focusable" href="#main">Skip to results</a>

  <header class="mb-3">
    <h1 class="h3 m-0">Search</h1>
  </header>

  <main id="main">
    <!-- Search form -->
    <form class="row g-2 mb-4" id="site-search-form" role="search" action="/search" method="get">
      <div class="col-auto">
        <label class="visually-hidden" for="q">Search query</label>
        <input class="form-control" type="search" name="q" id="q" placeholder="Search…" aria-label="Search" />
      </div>
      <div class="col-auto">
        <button class="btn btn-primary" type="submit">Search</button>
      </div>
    </form>

    <!-- Live region: results summary -->
    <div id="results-info" class="small text-muted mb-2" aria-live="polite"></div>

    <!-- Results list -->
    <div id="results" class="list-group" aria-label="Search results"></div>
  </main>

  <!-- Fuse.js (lightweight fuzzy search) -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <script>
    (async function() {
      const params = new URLSearchParams(location.search);
      const query = (params.get('q') || '').trim();
      const qInput = document.getElementById('q');
      const info = document.getElementById('results-info');
      const list = document.getElementById('results');

      // Prefill query from URL
      qInput.value = query;

      // Choose English index for this page
      const indexPath = '/static/search-index-en.json';

      // Fetch index
      let data = [];
      try {
        const res = await fetch(indexPath, { cache: 'no-store' });
        data = await res.json();
      } catch (e) {
        info.textContent = 'Could not load search index.';
        return;
      }

      // Init Fuse
      const fuse = new Fuse(data, {
        includeScore: true,
        minMatchCharLength: 2,
        threshold: 0.4,
        keys: [
          { name: 'title', weight: 0.6 },
          { name: 'content', weight: 0.4 }
        ]
      });

      let results = [];
      if (query.length >= 2) {
        results = fuse.search(query).slice(0, 20);
      }

      // Render
      list.innerHTML = '';
      if (!query) {
        info.textContent = 'Type at least 2 characters to search.';
        return;
      }

      info.textContent = results.length
        ? `${results.length} ${results.length === 1 ? 'result' : 'results'} for “${query}”.`
        : `No results for “${query}”.`;

      results.forEach(r => {
        const item = r.item;
        const snippet = (item.content || '');
        const short = snippet.length > 160 ? snippet.slice(0, 160) + '…' : snippet;

        const a = document.createElement('a');
        a.className = 'list-group-item list-group-item-action';
        a.href = item.url;
        a.innerHTML = `
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">${item.title}</h5>
          </div>
          <p class="mb-1">${short}</p>
          <small class="text-muted">${item.url}</small>
        `;
        list.appendChild(a);
      });

      // Focus first result for keyboard users
      if (results.length) {
        const first = list.querySelector('a');
        if (first) first.focus();
      }

      // Update URL on submit (bookmarkable)
      document.getElementById('site-search-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const newQ = qInput.value.trim();
        const url = new URL(location.href);
        if (newQ) url.searchParams.set('q', newQ); else url.searchParams.delete('q');
        location.href = url.toString();
      });
    })();
  </script>
</body>
</html>
